<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='.07em' y='.82em' font-size='100'>📝</text></svg>"><title>使用 acme.sh 给群晖申请 SSL 证书</title><link rel="stylesheet" href="https://storage.roamnote.com:8000/index.css"><script src="https://storage.roamnote.com:8000/fuse.js"></script>
<script src="https://storage.roamnote.com:8000/index.js"></script>
<script>window.onload=async()=>{moveBreadcrumb(),closeTocWhenScroll(),updateHeaderBgColor(),initialSearch("https://storage.roamnote.com:8000/index.json")}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QC2GM314WK"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QC2GM314WK")</script></head><body><header><nav id="Breadcrumb"><a href="/" title="漫游笔记" data-short-title="🏠"><span>🏠 漫游笔记</span></a>
<a href="/play-with-code/" title="Play With Code" data-short-title="Play"><span title="Play With Code">Play With Code</span></a>
<a href="/play-with-code/%E4%BD%BF%E7%94%A8-acme.sh-%E7%BB%99%E7%BE%A4%E6%99%96%E7%94%B3%E8%AF%B7-ssl-%E8%AF%81%E4%B9%A6/" title="使用 acme.sh 给群晖申请 SSL 证书" data-short-title="使用ac"><span id="LastBreadcrumb" title="使用 acme.sh 给群晖申请 SSL 证书">使用 acme.sh 给群晖申请 SSL 证书</span></a></nav><div id="Toolbar" data-nosnippet=""><details id="TocButton"><summary><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></summary><nav id="TableOfContents"><ul><li><a href="#安装-acmesh">安装 acme.sh</a></li><li><a href="#申请证书">申请证书</a></li><li><a href="#把证书部署到-dsm-中">把证书部署到 DSM 中</a></li><li><a href="#renew-证书">renew 证书</a></li></ul></nav><div id="TocHeaderMask"></div></details><button id="SearchButton">🔍</button></div></header><div id="SearchBox" data-nosnippet=""><input id="SearchInput" tabindex="0" autocomplete="off" placeholder="搜索"><div id="SearchToolBar"></div><div id="SearchResults" class="no-hover"></div></div><main><article pageurl="/play-with-code/%E4%BD%BF%E7%94%A8-acme.sh-%E7%BB%99%E7%BE%A4%E6%99%96%E7%94%B3%E8%AF%B7-ssl-%E8%AF%81%E4%B9%A6/" pagetitle="使用 acme.sh 给群晖申请 SSL 证书"><h1 id="a0">使用 acme.sh 给群晖申请 SSL 证书</h1><time id="UpdateDate">2024年03月02日</time><aside id="TocArticle"><nav id="TableOfContents"><ul id="a4"><li id="a5"><a href="#安装-acmesh" id="a6">安装 acme.sh</a></li><li id="a7"><a href="#申请证书" id="a8">申请证书</a></li><li id="a9"><a href="#把证书部署到-dsm-中" id="a10">把证书部署到 DSM 中</a></li><li id="a11"><a href="#renew-证书" id="a12">renew 证书</a></li></ul></nav></aside><a id="fixYOffset" class="internal-link" href="#" style=""></a><h2 class="heading" id="安装-acmesh">安装 acme.sh<a class="heading-anchor" href="/play-with-code/%E4%BD%BF%E7%94%A8-acme.sh-%E7%BB%99%E7%BE%A4%E6%99%96%E7%94%B3%E8%AF%B7-ssl-%E8%AF%81%E4%B9%A6/#%e5%ae%89%e8%a3%85-acmesh" id="a15"></a></h2><p id="a16"><span class="unwrap" id="a17">执行 <code id="a18">curl https://get.acme.sh | sh -s email=xxx@xxx.com</code> 即可安装。如果报错提示需要安装 crontab，可以使用 –force 参数强制安装。参看 <a href="https://github.com/acmesh-official/acme.sh?tab=readme-ov-file#1-how-to-install" class="external-link" target="_blank" id="a19">https://github.com/acmesh-official/acme.sh?tab=readme-ov-file#1-how-to-install</a></span></p><h2 class="heading" id="申请证书">申请证书<a class="heading-anchor" href="/play-with-code/%E4%BD%BF%E7%94%A8-acme.sh-%E7%BB%99%E7%BE%A4%E6%99%96%E7%94%B3%E8%AF%B7-ssl-%E8%AF%81%E4%B9%A6/#%e7%94%b3%e8%af%b7%e8%af%81%e4%b9%a6" id="a21"></a></h2><ol id="a22"><li id="a23">申请 cloudflare token： <a href="https://dash.cloudflare.com/profile/api-tokens" class="external-link" target="_blank" id="a24">https://dash.cloudflare.com/profile/api-tokens</a> 。参考 <a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi#1-cloudflare-option" class="external-link" target="_blank" id="a25">https://github.com/acmesh-official/acme.sh/wiki/dnsapi#1-cloudflare-option</a></li><li id="a26">导出 token：<code id="a27">export CF_Token="xxxx"</code></li><li id="a28">导出 email：<code id="a29">export CF_Email="xxxx@xxx.com"</code></li><li id="a30">执行命令：<code id="a31">~/.acme.sh/acme.sh --issue --dns dns_cf --server letsencrypt -d xxx.com -d '*.xxx.com'</code></li></ol><h2 class="heading" id="把证书部署到-dsm-中">把证书部署到 DSM 中<a class="heading-anchor" href="/play-with-code/%E4%BD%BF%E7%94%A8-acme.sh-%E7%BB%99%E7%BE%A4%E6%99%96%E7%94%B3%E8%AF%B7-ssl-%E8%AF%81%E4%B9%A6/#%e6%8a%8a%e8%af%81%e4%b9%a6%e9%83%a8%e7%bd%b2%e5%88%b0-dsm-%e4%b8%ad" id="a33"></a></h2><ol id="a34"><li id="a35">接下来把证书放到群晖的 DSM 中，参考： <a href="https://github.com/acmesh-official/acme.sh/wiki/deployhooks#20-deploy-the-certificate-to-synology-dsm" class="external-link" target="_blank" id="a36">https://github.com/acmesh-official/acme.sh/wiki/deployhooks#20-deploy-the-certificate-to-synology-dsm</a></li><li id="a37">导出群晖的管理员用户名： <code id="a38">export SYNO_Username="xxx"</code></li><li id="a39">导出群晖的管理员密码：<code id="a40">export SYNO_Password="xxx"</code></li><li id="a41">导出群晖 DSM 使用的 http schema：<code id="a42">export SYNO_Scheme="https"</code>。可选，默认为 <code id="a43">http</code>。</li><li id="a44">导出群晖 DSM 的 url：<code id="a45">export SYNO_Hostname="192.168.1.128"</code>。可选，默认为 <code id="a46">localhost</code></li><li id="a47">导出 DSM 所在的端口号：<code id="a48">export SYNO_Port="5001"</code>。可选，默认为 <code id="a49">5000</code></li><li id="a50">执行：<code id="a51">acme.sh --deploy --deploy-hook synology_dsm -d xxx.com</code>，如果开启了两步验证，会被要求输入 OTP 码（从群晖的 Secure SignIn APP 获取）</li></ol><h2 class="heading" id="renew-证书">renew 证书<a class="heading-anchor" href="/play-with-code/%E4%BD%BF%E7%94%A8-acme.sh-%E7%BB%99%E7%BE%A4%E6%99%96%E7%94%B3%E8%AF%B7-ssl-%E8%AF%81%E4%B9%A6/#renew-%e8%af%81%e4%b9%a6" id="a53"></a></h2><p id="a54"><span class="unwrap" id="a55">定时执行：</span></p><div class="highlight" id="a56"><pre tabindex="0" class="torchlight" style="overflow: hidden;" data-torchlight-processed="3449c9e5e332f1dbb81505cd739fbf3f" onmouseenter="setTimeout(function() { this.style.overflow = 'auto'; }.bind(this), 300)" onmouseleave="this.style.overflow = 'hidden';" ontouchstart="setTimeout(function() { this.style.overflow = 'auto'; }.bind(this), 300)" id="a57"><button data-text="复制" onclick="window.navigator.clipboard.writeText(nextElementSibling.innerText.replace(/&nbsp;/g, ''));this.setAttribute('data-text', '已复制');style='background-color: #009900';setTimeout(() => {this.setAttribute('data-text', '复制');this.removeAttribute('style')}, 1000);" id="a58"></button><code id="a59"><!-- Syntax highlighted by torchlight.dev --><div class="line" id="a60"><span style="color: #F8F8F2;" id="a61">#!/bin/bash</span></div><div class="line" id="a62"><span style="color: #F8F8F2;" id="a63">export CF_Token="xxx"</span></div><div class="line" id="a64"><span style="color: #F8F8F2;" id="a65">export CF_Email="xx@xxx.com"</span></div><div class="line" id="a66"><span style="color: #F8F8F2;" id="a67">acme.sh --renew -d xxx.com</span></div><div class="line" id="a68">&nbsp;</div><div class="line" id="a69"><span style="color: #F8F8F2;" id="a70">export SYNO_Username="xxx"</span></div><div class="line" id="a71"><span style="color: #F8F8F2;" id="a72">export SYNO_Password="xxx"</span></div><div class="line" id="a73"><span style="color: #F8F8F2;" id="a74">export SYNO_Scheme="https"</span></div><div class="line" id="a75"><span style="color: #F8F8F2;" id="a76">export SYNO_Hostname="192.168.1.128"</span></div><div class="line" id="a77"><span style="color: #F8F8F2;" id="a78">export SYNO_Port="5001"</span></div><div class="line" id="a79"><span style="color: #F8F8F2;" id="a80">acme.sh --deploy --deploy-hook synology_dsm -d xxx.com</span></div></code></pre></div></article><aside id="TocAside" data-nosnippet=""><style>@media(min-width:1201px) and (max-width:1500px){main{margin-left:calc(50% - 600px)!important}}</style><nav id="TableOfContents"><ul><li><a href="#安装-acmesh">安装 acme.sh</a></li><li><a href="#申请证书">申请证书</a></li><li><a href="#把证书部署到-dsm-中">把证书部署到 DSM 中</a></li><li><a href="#renew-证书">renew 证书</a></li></ul></nav></aside><picture><source srcset="https://storage.roamnote.com:8000/bg.png"><img src="https://storage.roamnote.com:8000/bg.avif" decoding="async" alt="漫游笔记" width="1920" style="aspect-ratio:1920/441"></picture></main></body></html>