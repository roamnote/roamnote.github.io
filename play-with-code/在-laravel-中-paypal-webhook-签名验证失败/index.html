<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='.07em' y='.82em' font-size='100'>📝</text></svg>"><title>在 Laravel 中 PayPal Webhook 签名验证失败</title><link rel="stylesheet" href="https://storage.roamnote.com:8000/index.css"><script src="https://storage.roamnote.com:8000/fuse.js"></script>
<script src="https://storage.roamnote.com:8000/index.js"></script>
<script>window.onload=async()=>{moveBreadcrumb(),closeTocWhenScroll(),updateHeaderBgColor(),initialSearch("https://storage.roamnote.com:8000/index.json")}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QC2GM314WK"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QC2GM314WK")</script></head><body><header><nav id="Breadcrumb"><a href="/" title="漫游笔记" data-short-title="🏠"><span>🏠 漫游笔记</span></a>
<a href="/play-with-code/" title="Play With Code" data-short-title="Play"><span title="Play With Code">Play With Code</span></a>
<a href="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/" title="在 Laravel 中 PayPal Webhook 签名验证失败" data-short-title="在Lar"><span id="LastBreadcrumb" title="在 Laravel 中 PayPal Webhook 签名验证失败">在 Laravel 中 PayPal Webhook 签名验证失败</span></a></nav><div id="Toolbar" data-nosnippet=""><details id="TocButton"><summary><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></summary><nav id="TableOfContents"><ul><li><a href="#背景">背景</a></li><li><a href="#问题">问题</a><ul><li><a href="#错误的数据">错误的数据</a></li><li><a href="#正确的数据">正确的数据</a></li></ul></li><li><a href="#怎么解决">怎么解决</a></li></ul></nav><div id="TocHeaderMask"></div></details><button id="SearchButton">🔍</button></div></header><div id="SearchBox" data-nosnippet=""><input id="SearchInput" tabindex="0" autocomplete="off" placeholder="搜索"><div id="SearchToolBar"></div><div id="SearchResults" class="no-hover"></div></div><main><article pageurl="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/" pagetitle="在 Laravel 中 PayPal Webhook 签名验证失败"><h1 id="a0">在 Laravel 中 PayPal Webhook 签名验证失败</h1><time id="UpdateDate">2024年01月22日</time><aside id="TocArticle"><nav id="TableOfContents"><ul id="a4"><li id="a5"><a href="#背景" id="a6">背景</a></li><li id="a7"><a href="#问题" id="a8">问题</a><ul id="a9"><li id="a10"><a href="#错误的数据" id="a11">错误的数据</a></li><li id="a12"><a href="#正确的数据" id="a13">正确的数据</a></li></ul></li><li id="a14"><a href="#怎么解决" id="a15">怎么解决</a></li></ul></nav></aside><a id="fixYOffset" class="internal-link" href="#" style=""></a><h2 class="heading" id="背景">背景<a class="heading-anchor" href="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/#%e8%83%8c%e6%99%af" id="a18"></a></h2><p id="a19"><span class="unwrap" id="a20">最近在工作中需要把集成 PayPal 到系统里。大体流程是：客户在网页上发起付款，跳转到 paypal 页面，客户付款之后，需要去确认用户是否付款成功。 PayPal 提供了 webhook，给调用者发送事件，例如：当客户点了付款的 button，PayPal 会发送 <code id="a21">CHECKOUT.ORDER.APPROVED</code> 事件给调用者。当 order 被捕获，付款完成之后，Paypal 会发送<code id="a22">PAYMENT.CAPTURE.COMPLETED</code>事件给调用者。</span></p><p id="a23"><span class="unwrap" id="a24">由于提供给 PayPal 调用的 API 是公开的，当这个 API 被调用的时候，提供方就需要确认这个请求是否是 PayPal 官方发起的，也就是所谓的验证签名。PayPal 提供了<a href="https://developer.paypal.com/docs/api/webhooks/v1/#verify-webhook-signature_post" class="external-link" target="_blank" id="a25">验证签名的 API</a>，需要按照它的要求，组装好数据，发送给 PayPal。</span></p><h2 class="heading" id="问题">问题<a class="heading-anchor" href="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/#%e9%97%ae%e9%a2%98" id="a27"></a></h2><p id="a28"><span class="unwrap" id="a29">组装好的数据，发送给 PayPal 之后，如果这个请求确实是 PayPal 发起的，它会返回 <code id="a30">{"verification_status":"SUCCESS"}</code>，否则会返回 <code id="a31">{"verification_status":"FAILURE"}</code></span></p><p id="a32"><span class="unwrap" id="a33">我所遇到的问题是，有些签名是 <code id="a34">SUCCESS</code>，但是有些签名是 <code id="a35">FAILURE</code>，这就很奇怪。经过了对比实验，发现了问题所在。</span></p><h3 class="heading" id="错误的数据">错误的数据<a class="heading-anchor" href="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/#%e9%94%99%e8%af%af%e7%9a%84%e6%95%b0%e6%8d%ae" id="a37"></a></h3><div class="highlight" id="a38"><pre tabindex="0" style="overflow: hidden;" class="torchlight" data-torchlight-processed="3449c9e5e332f1dbb81505cd739fbf3f" onmouseenter="setTimeout(function() { this.style.overflow = 'auto'; }.bind(this), 300)" onmouseleave="this.style.overflow = 'hidden';" ontouchstart="setTimeout(function() { this.style.overflow = 'auto'; }.bind(this), 300)" id="a39"><button data-text="复制" onclick="window.navigator.clipboard.writeText(nextElementSibling.innerText.replace(/&nbsp;/g, ''));this.setAttribute('data-text', '已复制');style='background-color: #009900';setTimeout(() => {this.setAttribute('data-text', '复制');this.removeAttribute('style')}, 1000);" id="a40"></button><code class="language-json" data-lang="json" id="a41"><!-- Syntax highlighted by torchlight.dev --><div class="line" id="a42"><span style="color: #F8F8F2;" id="a43">{</span></div><div class="line" id="a44"><span style="color: #F8F8F2;" id="a45">    </span><span style="color: #66D9EF;" id="a46">"webhook_id"</span><span style="color: #F8F8F2;" id="a47">: </span><span style="color: #CFCFC2;" id="a48">"{{webhook_id}}"</span><span style="color: #F8F8F2;" id="a49">,</span></div><div class="line" id="a50"><span style="color: #F8F8F2;" id="a51">    </span><span style="color: #66D9EF;" id="a52">"transmission_id"</span><span style="color: #F8F8F2;" id="a53">: </span><span style="color: #CFCFC2;" id="a54">"{{event_transmission_id}}"</span><span style="color: #F8F8F2;" id="a55">,</span></div><div class="line" id="a56"><span style="color: #F8F8F2;" id="a57">    </span><span style="color: #66D9EF;" id="a58">"transmission_time"</span><span style="color: #F8F8F2;" id="a59">: </span><span style="color: #CFCFC2;" id="a60">"{{event_transmission_time}}"</span><span style="color: #F8F8F2;" id="a61">,</span></div><div class="line" id="a62"><span style="color: #F8F8F2;" id="a63">    </span><span style="color: #66D9EF;" id="a64">"cert_url"</span><span style="color: #F8F8F2;" id="a65">: </span><span style="color: #CFCFC2;" id="a66">"{{event_cert_url}}"</span><span style="color: #F8F8F2;" id="a67">,</span></div><div class="line" id="a68"><span style="color: #F8F8F2;" id="a69">    </span><span style="color: #66D9EF;" id="a70">"auth_algo"</span><span style="color: #F8F8F2;" id="a71">: </span><span style="color: #CFCFC2;" id="a72">"{{event_auth_algo}}"</span><span style="color: #F8F8F2;" id="a73">,</span></div><div class="line" id="a74"><span style="color: #F8F8F2;" id="a75">    </span><span style="color: #66D9EF;" id="a76">"transmission_sig"</span><span style="color: #F8F8F2;" id="a77">: </span><span style="color: #CFCFC2;" id="a78">"{{event_transmission_sig}}"</span><span style="color: #F8F8F2;" id="a79">,</span></div><div class="line" id="a80"><span style="color: #F8F8F2;" id="a81">    </span><span style="color: #66D9EF;" id="a82">"webhook_event"</span><span style="color: #F8F8F2;" id="a83">: {</span></div><div class="line" id="a84"><span style="color: #F8F8F2;" id="a85">        </span><span style="color: #66D9EF;" id="a86">"id"</span><span style="color: #F8F8F2;" id="a87">: </span><span style="color: #CFCFC2;" id="a88">"xxx"</span><span style="color: #F8F8F2;" id="a89">,</span></div><div class="line" id="a90"><span style="color: #F8F8F2;" id="a91">        </span><span style="color: #66D9EF;" id="a92">"event_version"</span><span style="color: #F8F8F2;" id="a93">: </span><span style="color: #CFCFC2;" id="a94">"1.0"</span><span style="color: #F8F8F2;" id="a95">,</span></div><div class="line" id="a96"><span style="color: #F8F8F2;" id="a97">        </span><span style="color: #66D9EF;" id="a98">"create_time"</span><span style="color: #F8F8F2;" id="a99">: </span><span style="color: #CFCFC2;" id="a100">"2023-12-04T07:06:02.318Z"</span><span style="color: #F8F8F2;" id="a101">,</span></div><div class="line" id="a102"><span style="color: #F8F8F2;" id="a103">        </span><span style="color: #66D9EF;" id="a104">"resource_type"</span><span style="color: #F8F8F2;" id="a105">: </span><span style="color: #CFCFC2;" id="a106">"checkout-order"</span><span style="color: #F8F8F2;" id="a107">,</span></div><div class="line" id="a108"><span style="color: #F8F8F2;" id="a109">        </span><span style="color: #66D9EF;" id="a110">"resource_version"</span><span style="color: #F8F8F2;" id="a111">: </span><span style="color: #CFCFC2;" id="a112">"2.0"</span><span style="color: #F8F8F2;" id="a113">,</span></div><div class="line" id="a114"><span style="color: #F8F8F2;" id="a115">        </span><span style="color: #66D9EF;" id="a116">"event_type"</span><span style="color: #F8F8F2;" id="a117">: </span><span style="color: #CFCFC2;" id="a118">"CHECKOUT.ORDER.APPROVED"</span><span style="color: #F8F8F2;" id="a119">,</span></div><div class="line" id="a120"><span style="color: #F8F8F2;" id="a121">        </span><span style="color: #66D9EF;" id="a122">"summary"</span><span style="color: #F8F8F2;" id="a123">: </span><span style="color: #CFCFC2;" id="a124">"An order has been approved by buyer"</span><span style="color: #F8F8F2;" id="a125">,</span></div><div class="line" id="a126"><span style="color: #F8F8F2;" id="a127">        </span><span style="color: #66D9EF;" id="a128">"resource"</span><span style="color: #F8F8F2;" id="a129">: {</span></div><div class="line" id="a130"><span style="color: #F8F8F2;" id="a131">            </span><span style="color: #66D9EF;" id="a132">"create_time"</span><span style="color: #F8F8F2;" id="a133">: </span><span style="color: #CFCFC2;" id="a134">"2023-12-04T07:05:52Z"</span><span style="color: #F8F8F2;" id="a135">,</span></div><div class="line" id="a136"><span style="color: #F8F8F2;" id="a137">            </span><span style="color: #66D9EF;" id="a138">"purchase_units"</span><span style="color: #F8F8F2;" id="a139">: [</span></div><div class="line" id="a140"><span style="color: #F8F8F2;" id="a141">                {</span></div><div class="line" id="a142"><span style="color: #F8F8F2;" id="a143">                    </span><span style="color: #66D9EF;" id="a144">"reference_id"</span><span style="color: #F8F8F2;" id="a145">: </span><span style="color: #CFCFC2;" id="a146">"default"</span><span style="color: #F8F8F2;" id="a147">,</span></div><div class="line" id="a148"><span style="color: #F8F8F2;" id="a149">                    </span><span style="color: #66D9EF;" id="a150">"amount"</span><span style="color: #F8F8F2;" id="a151">: {</span></div><div class="line" id="a152"><span style="color: #F8F8F2;" id="a153">                        </span><span style="color: #66D9EF;" id="a154">"currency_code"</span><span style="color: #F8F8F2;" id="a155">: </span><span style="color: #CFCFC2;" id="a156">"AUD"</span><span style="color: #F8F8F2;" id="a157">,</span></div><div class="line" id="a158"><span style="color: #F8F8F2;" id="a159">                        </span><span style="color: #66D9EF;" id="a160">"value"</span><span style="color: #F8F8F2;" id="a161">: </span><span style="color: #CFCFC2;" id="a162">"0.10"</span><span style="color: #F8F8F2;" id="a163">,</span></div><div class="line" id="a164"><span style="color: #F8F8F2;" id="a165">                        </span><span style="color: #66D9EF;" id="a166">"breakdown"</span><span style="color: #F8F8F2;" id="a167">: []</span></div><div class="line" id="a168"><span style="color: #F8F8F2;" id="a169">                    }</span></div><div class="line" id="a170"><span style="color: #F8F8F2;" id="a171">                }</span></div><div class="line" id="a172"><span style="color: #F8F8F2;" id="a173">            ],</span></div><div class="line" id="a174"><span style="color: #F8F8F2;" id="a175">            </span><span style="color: #66D9EF;" id="a176">"xxx"</span><span style="color: #F8F8F2;" id="a177">: </span><span style="color: #CFCFC2;" id="a178">"xxx"</span></div><div class="line" id="a179"><span style="color: #F8F8F2;" id="a180">        }</span></div><div class="line" id="a181"><span style="color: #F8F8F2;" id="a182">    }</span></div><div class="line" id="a183"><span style="color: #F8F8F2;" id="a184">}</span></div></code></pre></div><h3 class="heading" id="正确的数据">正确的数据<a class="heading-anchor" href="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/#%e6%ad%a3%e7%a1%ae%e7%9a%84%e6%95%b0%e6%8d%ae" id="a186"></a></h3><div class="highlight" id="a187"><pre tabindex="0" style="overflow: hidden;" class="torchlight" data-torchlight-processed="3449c9e5e332f1dbb81505cd739fbf3f" onmouseenter="setTimeout(function() { this.style.overflow = 'auto'; }.bind(this), 300)" onmouseleave="this.style.overflow = 'hidden';" ontouchstart="setTimeout(function() { this.style.overflow = 'auto'; }.bind(this), 300)" id="a188"><button data-text="复制" onclick="window.navigator.clipboard.writeText(nextElementSibling.innerText.replace(/&nbsp;/g, ''));this.setAttribute('data-text', '已复制');style='background-color: #009900';setTimeout(() => {this.setAttribute('data-text', '复制');this.removeAttribute('style')}, 1000);" id="a189"></button><code class="language-json" data-lang="json" id="a190"><!-- Syntax highlighted by torchlight.dev --><div class="line" id="a191"><span style="color: #F8F8F2;" id="a192">{</span></div><div class="line" id="a193"><span style="color: #F8F8F2;" id="a194">    </span><span style="color: #66D9EF;" id="a195">"webhook_id"</span><span style="color: #F8F8F2;" id="a196">: </span><span style="color: #CFCFC2;" id="a197">"{{webhook_id}}"</span><span style="color: #F8F8F2;" id="a198">,</span></div><div class="line" id="a199"><span style="color: #F8F8F2;" id="a200">    </span><span style="color: #66D9EF;" id="a201">"transmission_id"</span><span style="color: #F8F8F2;" id="a202">: </span><span style="color: #CFCFC2;" id="a203">"{{event_transmission_id}}"</span><span style="color: #F8F8F2;" id="a204">,</span></div><div class="line" id="a205"><span style="color: #F8F8F2;" id="a206">    </span><span style="color: #66D9EF;" id="a207">"transmission_time"</span><span style="color: #F8F8F2;" id="a208">: </span><span style="color: #CFCFC2;" id="a209">"{{event_transmission_time}}"</span><span style="color: #F8F8F2;" id="a210">,</span></div><div class="line" id="a211"><span style="color: #F8F8F2;" id="a212">    </span><span style="color: #66D9EF;" id="a213">"cert_url"</span><span style="color: #F8F8F2;" id="a214">: </span><span style="color: #CFCFC2;" id="a215">"{{event_cert_url}}"</span><span style="color: #F8F8F2;" id="a216">,</span></div><div class="line" id="a217"><span style="color: #F8F8F2;" id="a218">    </span><span style="color: #66D9EF;" id="a219">"auth_algo"</span><span style="color: #F8F8F2;" id="a220">: </span><span style="color: #CFCFC2;" id="a221">"{{event_auth_algo}}"</span><span style="color: #F8F8F2;" id="a222">,</span></div><div class="line" id="a223"><span style="color: #F8F8F2;" id="a224">    </span><span style="color: #66D9EF;" id="a225">"transmission_sig"</span><span style="color: #F8F8F2;" id="a226">: </span><span style="color: #CFCFC2;" id="a227">"{{event_transmission_sig}}"</span><span style="color: #F8F8F2;" id="a228">,</span></div><div class="line" id="a229"><span style="color: #F8F8F2;" id="a230">    </span><span style="color: #66D9EF;" id="a231">"webhook_event"</span><span style="color: #F8F8F2;" id="a232">: {</span></div><div class="line" id="a233"><span style="color: #F8F8F2;" id="a234">        </span><span style="color: #66D9EF;" id="a235">"id"</span><span style="color: #F8F8F2;" id="a236">: </span><span style="color: #CFCFC2;" id="a237">"xxx"</span><span style="color: #F8F8F2;" id="a238">,</span></div><div class="line" id="a239"><span style="color: #F8F8F2;" id="a240">        </span><span style="color: #66D9EF;" id="a241">"event_version"</span><span style="color: #F8F8F2;" id="a242">: </span><span style="color: #CFCFC2;" id="a243">"1.0"</span><span style="color: #F8F8F2;" id="a244">,</span></div><div class="line" id="a245"><span style="color: #F8F8F2;" id="a246">        </span><span style="color: #66D9EF;" id="a247">"create_time"</span><span style="color: #F8F8F2;" id="a248">: </span><span style="color: #CFCFC2;" id="a249">"2023-12-04T07:06:02.318Z"</span><span style="color: #F8F8F2;" id="a250">,</span></div><div class="line" id="a251"><span style="color: #F8F8F2;" id="a252">        </span><span style="color: #66D9EF;" id="a253">"resource_type"</span><span style="color: #F8F8F2;" id="a254">: </span><span style="color: #CFCFC2;" id="a255">"checkout-order"</span><span style="color: #F8F8F2;" id="a256">,</span></div><div class="line" id="a257"><span style="color: #F8F8F2;" id="a258">        </span><span style="color: #66D9EF;" id="a259">"resource_version"</span><span style="color: #F8F8F2;" id="a260">: </span><span style="color: #CFCFC2;" id="a261">"2.0"</span><span style="color: #F8F8F2;" id="a262">,</span></div><div class="line" id="a263"><span style="color: #F8F8F2;" id="a264">        </span><span style="color: #66D9EF;" id="a265">"event_type"</span><span style="color: #F8F8F2;" id="a266">: </span><span style="color: #CFCFC2;" id="a267">"CHECKOUT.ORDER.APPROVED"</span><span style="color: #F8F8F2;" id="a268">,</span></div><div class="line" id="a269"><span style="color: #F8F8F2;" id="a270">        </span><span style="color: #66D9EF;" id="a271">"summary"</span><span style="color: #F8F8F2;" id="a272">: </span><span style="color: #CFCFC2;" id="a273">"An order has been approved by buyer"</span><span style="color: #F8F8F2;" id="a274">,</span></div><div class="line" id="a275"><span style="color: #F8F8F2;" id="a276">        </span><span style="color: #66D9EF;" id="a277">"resource"</span><span style="color: #F8F8F2;" id="a278">: {</span></div><div class="line" id="a279"><span style="color: #F8F8F2;" id="a280">            </span><span style="color: #66D9EF;" id="a281">"create_time"</span><span style="color: #F8F8F2;" id="a282">: </span><span style="color: #CFCFC2;" id="a283">"2023-12-04T07:05:52Z"</span><span style="color: #F8F8F2;" id="a284">,</span></div><div class="line" id="a285"><span style="color: #F8F8F2;" id="a286">            </span><span style="color: #66D9EF;" id="a287">"purchase_units"</span><span style="color: #F8F8F2;" id="a288">: [</span></div><div class="line" id="a289"><span style="color: #F8F8F2;" id="a290">                {</span></div><div class="line" id="a291"><span style="color: #F8F8F2;" id="a292">                    </span><span style="color: #66D9EF;" id="a293">"reference_id"</span><span style="color: #F8F8F2;" id="a294">: </span><span style="color: #CFCFC2;" id="a295">"default"</span><span style="color: #F8F8F2;" id="a296">,</span></div><div class="line" id="a297"><span style="color: #F8F8F2;" id="a298">                    </span><span style="color: #66D9EF;" id="a299">"amount"</span><span style="color: #F8F8F2;" id="a300">: {</span></div><div class="line" id="a301"><span style="color: #F8F8F2;" id="a302">                        </span><span style="color: #66D9EF;" id="a303">"currency_code"</span><span style="color: #F8F8F2;" id="a304">: </span><span style="color: #CFCFC2;" id="a305">"AUD"</span><span style="color: #F8F8F2;" id="a306">,</span></div><div class="line" id="a307"><span style="color: #F8F8F2;" id="a308">                        </span><span style="color: #66D9EF;" id="a309">"value"</span><span style="color: #F8F8F2;" id="a310">: </span><span style="color: #CFCFC2;" id="a311">"0.10"</span><span style="color: #F8F8F2;" id="a312">,</span></div><div class="line" id="a313"><span style="color: #F8F8F2;" id="a314">                        </span><span style="color: #66D9EF;" id="a315">"breakdown"</span><span style="color: #F8F8F2;" id="a316">: {}</span></div><div class="line" id="a317"><span style="color: #F8F8F2;" id="a318">                    }</span></div><div class="line" id="a319"><span style="color: #F8F8F2;" id="a320">                }</span></div><div class="line" id="a321"><span style="color: #F8F8F2;" id="a322">            ],</span></div><div class="line" id="a323"><span style="color: #F8F8F2;" id="a324">            </span><span style="color: #66D9EF;" id="a325">"xxx"</span><span style="color: #F8F8F2;" id="a326">: </span><span style="color: #CFCFC2;" id="a327">"xxx"</span></div><div class="line" id="a328"><span style="color: #F8F8F2;" id="a329">        }</span></div><div class="line" id="a330"><span style="color: #F8F8F2;" id="a331">    }</span></div><div class="line" id="a332"><span style="color: #F8F8F2;" id="a333">}</span></div></code></pre></div><p id="a334"><span class="unwrap" id="a335">它们不一样的地方是： <code id="a336">webhook_event.resource.purchase_units.amount.breakdown</code>，正确的数据是一对 <code id="a337">{}</code>，而错误的数据是一对 <code id="a338">[]</code>。</span></p><p id="a339"><span class="unwrap" id="a340">为什么会出现这种原因呢？是因为我使用的是 Laravel 框架，而 <code id="a341">webhook_event</code> 是通过 <code id="a342">$request-&gt;all()</code> 得到的。Laravel 默认会把空对象转换为空数组。就导致了这个悲剧发生。</span></p><h2 class="heading" id="怎么解决">怎么解决<a class="heading-anchor" href="/play-with-code/%E5%9C%A8-laravel-%E4%B8%AD-paypal-webhook-%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5/#%e6%80%8e%e4%b9%88%e8%a7%a3%e5%86%b3" id="a344"></a></h2><p id="a345"><span class="unwrap" id="a346">只需要拿到 raw 请求数据，然后把 json 转换为一个对象既可。</span></p><p id="a347"><span class="unwrap" id="a348">拿到 raw 请求数据的方式有：</span></p><ul id="a349"><li id="a350"><code id="a351">$request-&gt;getContent()</code></li><li id="a352"><code id="a353">file_get_contents('php://input')</code></li></ul><p id="a354"><span class="unwrap" id="a355">拿到数据之后，使用 <code id="a356">json_decode($rawData, false)</code> 既可把数据转换为一个对象。</span></p></article><aside id="TocAside" data-nosnippet=""><style>@media(min-width:1201px) and (max-width:1500px){main{margin-left:calc(50% - 600px)!important}}</style><nav id="TableOfContents"><ul><li><a href="#背景">背景</a></li><li><a href="#问题">问题</a><ul><li><a href="#错误的数据">错误的数据</a></li><li><a href="#正确的数据">正确的数据</a></li></ul></li><li><a href="#怎么解决">怎么解决</a></li></ul></nav></aside><picture><source srcset="https://storage.roamnote.com:8000/bg.png"><img src="https://storage.roamnote.com:8000/bg.avif" decoding="async" alt="漫游笔记" width="1920" style="aspect-ratio:1920/441"></picture></main></body></html>